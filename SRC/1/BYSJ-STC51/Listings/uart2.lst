C51 COMPILER V9.56.0.0   UART2                                                             09/03/2018 23:01:55 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE UART2
OBJECT MODULE PLACED IN .\Objects\uart2.obj
COMPILER INVOKED BY: D:\Program Files\Keil\C51\BIN\C51.EXE src\uart2.c LARGE OPTIMIZE(8,SPEED) BROWSE INCDIR(.\inc) DEBU
                    -G OBJECTEXTEND PRINT(.\Listings\uart2.lst) TABS(2) OBJECT(.\Objects\uart2.obj)

line level    source

   1          #include"uart2.h"
   2          
   3          #define S2RI  0x01              //S2CON.0
   4          #define S2TI  0x02              //S2CON.1
   5          #define TIME_OUT    40
   6          
   7          bit busy2;
   8          u8 UART2_RX_BUF[BUFFER_LENGTH];
   9          u8 uart2RxSta = 0;
  10          u8 uart2RxCount;
  11          u8 uart2RxTimeOut;
  12          u8 flag_uart2_rx;
  13          
  14          
  15          
  16          void Uart2Init(void)    //115200@24.000MHz
  17          {
  18   1        P_SW2 &= ~0x01;
  19   1        S2CON = 0x50;   //8位数据,可变波特率
  20   1        AUXR |= 0x04;   //定时器2时钟为Fosc,即1T
  21   1      //  T2L = 0x98;   //设定定时初值
  22   1      //  T2H = 0xFF;   //设定定时初值
  23   1        T2L = 0xCC;   //设定定时初值
  24   1        T2H = 0xFF;   //设定定时初值
  25   1        AUXR |= 0x10;   //启动定时器2
  26   1        
  27   1        UART2_INT_ENABLE();
  28   1        S2_RX_Enable();
  29   1      }
  30          
  31          /*----------------------------
  32          UART2 中断服务程序
  33          -----------------------------*/
  34          void Uart2() interrupt 8 using 1
  35          {
  36   1          if (S2CON & S2RI)
  37   1          {
  38   2              S2CON &= ~S2RI;         //清除S2RI位
  39   2          if (uart2RxSta == 0) flag_uart2_rx = 1;
  40   2          if(uart2RxCount < BUFFER_LENGTH){
  41   3            uart2RxTimeOut = TIME_OUT;
  42   3            UART2_RX_BUF[uart2RxCount++] = S2BUF;
  43   3          }else{
  44   3            uart2RxSta = 1;
  45   3            uart2RxCount = 0;
  46   3          }
  47   2          }
  48   1          if (S2CON & S2TI)
  49   1          {
  50   2              S2CON &= ~S2TI;         //清除S2TI位
  51   2              busy2 = 0;               //清忙标志
  52   2          }
  53   1      }
  54          
C51 COMPILER V9.56.0.0   UART2                                                             09/03/2018 23:01:55 PAGE 2   

  55          /*----------------------------
  56          发送串口数据
  57          ----------------------------*/
  58          void SendData(u8 dat)
  59          {
  60   1          while (busy2);               //等待前面的数据发送完成
  61   1          busy2 = 1;
  62   1          S2BUF = dat;                //写数据到UART2数据寄存器
  63   1      }
  64          
  65          /*----------------------------
  66          发送字符串
  67          ----------------------------*/
  68          void SendString2(char *s)
  69          {
  70   1          while (*s)                  //检测字符串结束标志
  71   1          {
  72   2              SendData(*s++);         //发送当前字符
  73   2          }
  74   1      }
  75          void clearBuf2(){
  76   1        unsigned char i;
  77   1        for(i = 0; i < BUFFER_LENGTH;i++){
  78   2          UART2_RX_BUF[i] = 0;
  79   2          uart2RxCount = 0;
  80   2        }
  81   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    205    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =    204       3
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
