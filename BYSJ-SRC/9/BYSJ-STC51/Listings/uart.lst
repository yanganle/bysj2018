C51 COMPILER V9.56.0.0   UART                                                              09/19/2018 23:15:32 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE UART
OBJECT MODULE PLACED IN .\Objects\uart.obj
COMPILER INVOKED BY: D:\Program Files\Keil\C51\BIN\C51.EXE src\uart.c LARGE OMF2 OPTIMIZE(8,SPEED) BROWSE INCDIR(.\inc) 
                    -DEBUG PRINT(.\Listings\uart.lst) TABS(2) OBJECT(.\Objects\uart.obj)

line level    source

   1          #include "uart.h"
   2          
   3          bit busy;
   4          u8 UART_RX_BUF[BUFFER_LENGTH];
   5          u8 uartRxSta = 0;
   6          u8 uartRxCount;
   7          u8 uartRxTimeOut;
   8          u8 flag_uart_rx;
   9          
  10          unsigned char cmd;
  11          
  12          void UartInit(void)   //115200bps@24.000MHz
  13          {
  14   1      
  15   1        SCON = 0x50;    //8位数据,可变波特率
  16   1        TMOD &= 0x0F;
  17   1        TMOD |= 0x20;   //设定定时器1为16位自动重装方式
  18   1        TH1 = 256-MAIN_Fosc/(Baud_Rate*12*16);      //设定定时初值
  19   1        TL1 = 256-MAIN_Fosc/(Baud_Rate*12*16);      //设定定时初值
  20   1        PCON |= 0x80;     //波特率加倍
  21   1        ES = 1;         //串行中断允许
  22   1        TR1 = 1;        //启动定时器1
  23   1        REN = 1;        //允许接收
  24   1        EA = 1;         //开启总中断
  25   1      }
  26          
  27          /*----------------------------
  28          UART 中断服务程序
  29          -----------------------------*/
  30          void Uart() interrupt 4
  31          {
  32   1          if (RI)
  33   1          {
  34   2              RI = 0;                 //清除RI位
  35   2              if (uartRxSta == 0) flag_uart_rx = 1;
  36   2              if(uartRxCount < BUFFER_LENGTH)
  37   2              {
  38   3                uartRxTimeOut = TIME_OUT;
  39   3                UART_RX_BUF[uartRxCount++] = SBUF;
  40   3              }else{
  41   3                uartRxSta = 1;
  42   3                uartRxCount = 0;
  43   3              }
  44   2          }
  45   1          if (TI)
  46   1          {
  47   2              TI = 0;                 //清除TI位
  48   2              busy = 0;               //清忙标志
  49   2          }
  50   1      }
  51          
  52          
  53          /*----------------------------
  54          发送串口数据
C51 COMPILER V9.56.0.0   UART                                                              09/19/2018 23:15:32 PAGE 2   

  55          ----------------------------*/
  56          void Putchar(char dat)
  57          {
  58   1          SBUF = dat;                //写数据到UART3数据寄存器
  59   1          busy = 1;
  60   1          while (busy);               //等待前面的数据发送完成
  61   1      }
  62          
  63          /*----------------------------
  64          发送字符串
  65          ----------------------------*/
  66          /*void uartSendString(char *s)
  67          {
  68              while (*s)                  //检测字符串结束标志
  69              {
  70                  Putchar(*s++);         //发送当前字符
  71              }
  72          }*/
  73          
  74          void uartSendData(char *buffer, u8 datalen)
  75          {
  76   1        u8 i;
  77   1        for(i=0;i<datalen;i++)
  78   1          Putchar(buffer[i]);
  79   1      }
  80          
  81          void clearBuf(void)
  82          {
  83   1        int i;
  84   1        for (i=0; i<BUFFER_LENGTH; i++)
  85   1        {
  86   2          UART_RX_BUF[i] = 0;
  87   2          uartRxCount = 0;
  88   2        }
  89   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    209    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     55       3
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
